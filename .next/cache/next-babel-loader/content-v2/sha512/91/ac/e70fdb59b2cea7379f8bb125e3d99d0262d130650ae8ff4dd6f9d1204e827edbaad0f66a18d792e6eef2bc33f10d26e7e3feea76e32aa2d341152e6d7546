{"ast":null,"code":"import { PrismaClient } from '@prisma/client';\nconst prisma = new PrismaClient();\n\nconst handler = async (req, res) => {\n  try {\n    if (!req.query.reportId) {\n      return res.status(304).json({\n        error: 'Empty reportId param'\n      });\n    }\n\n    const reportId = req.query.reportId.toString();\n    console.log('req.body: ', JSON.parse(req.body));\n    const data = JSON.parse(req.body);\n    const {\n      payload\n    } = data;\n\n    if (payload.ticketState !== 'RESOLVED' || payload.ticketState !== 'BLOCKED') {\n      res.end();\n      return;\n    }\n\n    const count = await prisma.report.count({\n      where: {\n        id: reportId\n      }\n    });\n\n    if (count === 0) {\n      res.end();\n      return;\n    }\n\n    await prisma.report.update({\n      where: {\n        id: reportId\n      },\n      data: {\n        status: payload.ticketState\n      }\n    });\n    const reports = await prisma.report.findMany({\n      where: {\n        status: 'OPEN'\n      }\n    });\n    res.setHeader('Access-Control-Allow-Origin', '*');\n    res.status(200).json({\n      reports\n    });\n    return res;\n  } catch (err) {\n    throw new Error(err);\n  }\n\n  ;\n};\n\nexport default handler;","map":{"version":3,"sources":["/Users/kodeemcintosh/Repos/coding-challenge/pages/api/reports/[reportId].ts"],"names":["PrismaClient","prisma","handler","req","res","query","reportId","status","json","error","toString","console","log","JSON","parse","body","data","payload","ticketState","end","count","report","where","id","update","reports","findMany","setHeader","err","Error"],"mappings":"AAEA,SAASA,YAAT,QAA6B,gBAA7B;AAEA,MAAMC,MAAM,GAAG,IAAID,YAAJ,EAAf;;AAEA,MAAME,OAAO,GAAG,OAAOC,GAAP,EAA4BC,GAA5B,KAAqD;AACnE,MAAI;AACF,QAAG,CAACD,GAAG,CAACE,KAAJ,CAAUC,QAAd,EAAwB;AACtB,aAAOF,GAAG,CAACG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAArB,CAAP;AACD;;AACD,UAAMH,QAAQ,GAAGH,GAAG,CAACE,KAAJ,CAAUC,QAAV,CAAmBI,QAAnB,EAAjB;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BC,IAAI,CAACC,KAAL,CAAWX,GAAG,CAACY,IAAf,CAA1B;AAEA,UAAMC,IAAI,GAAGH,IAAI,CAACC,KAAL,CAAWX,GAAG,CAACY,IAAf,CAAb;AACA,UAAM;AAAEE,MAAAA;AAAF,QAAcD,IAApB;;AACA,QAAGC,OAAO,CAACC,WAAR,KAAwB,UAAxB,IAAsCD,OAAO,CAACC,WAAR,KAAwB,SAAjE,EAA4E;AAC1Ed,MAAAA,GAAG,CAACe,GAAJ;AACA;AACD;;AAED,UAAMC,KAAK,GAAG,MAAMnB,MAAM,CAACoB,MAAP,CAAcD,KAAd,CAAoB;AACtCE,MAAAA,KAAK,EAAE;AACLC,QAAAA,EAAE,EAAEjB;AADC;AAD+B,KAApB,CAApB;;AAKA,QAAGc,KAAK,KAAK,CAAb,EAAgB;AACdhB,MAAAA,GAAG,CAACe,GAAJ;AACA;AACD;;AAED,UAAMlB,MAAM,CAACoB,MAAP,CAAcG,MAAd,CAAqB;AACzBF,MAAAA,KAAK,EAAE;AACLC,QAAAA,EAAE,EAAEjB;AADC,OADkB;AAIzBU,MAAAA,IAAI,EAAE;AACJT,QAAAA,MAAM,EAAEU,OAAO,CAACC;AADZ;AAJmB,KAArB,CAAN;AASA,UAAMO,OAAO,GAAG,MAAMxB,MAAM,CAACoB,MAAP,CAAcK,QAAd,CAAuB;AAC3CJ,MAAAA,KAAK,EAAE;AACLf,QAAAA,MAAM,EAAE;AADH;AADoC,KAAvB,CAAtB;AAMAH,IAAAA,GAAG,CAACuB,SAAJ,CAAc,6BAAd,EAA6C,GAA7C;AACAvB,IAAAA,GAAG,CAACG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEiB,MAAAA;AAAF,KAArB;AACA,WAAOrB,GAAP;AACD,GA1CD,CA0CE,OAAMwB,GAAN,EAAW;AACX,UAAM,IAAIC,KAAJ,CAAUD,GAAV,CAAN;AACD;;AAAA;AACF,CA9CD;;AAiDA,eAAe1B,OAAf","sourcesContent":["\nimport { NextApiRequest, NextApiResponse } from \"next\";\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nconst handler = async (req: NextApiRequest, res: NextApiResponse) => {\n  try {\n    if(!req.query.reportId) {\n      return res.status(304).json({ error: 'Empty reportId param' });\n    }\n    const reportId = req.query.reportId.toString();\n    console.log('req.body: ', JSON.parse(req.body));\n\n    const data = JSON.parse(req.body);\n    const { payload } = data;\n    if(payload.ticketState !== 'RESOLVED' || payload.ticketState !== 'BLOCKED') {\n      res.end();\n      return;\n    }\n\n    const count = await prisma.report.count({\n      where: {\n        id: reportId\n      }\n    });\n    if(count === 0) {\n      res.end();\n      return;\n    }\n\n    await prisma.report.update({\n      where: {\n        id: reportId\n      },\n      data: {\n        status: payload.ticketState\n      }\n    });\n\n    const reports = await prisma.report.findMany({\n      where: {\n        status: 'OPEN'\n      }\n    });\n\n    res.setHeader('Access-Control-Allow-Origin', '*');\n    res.status(200).json({ reports });\n    return res;\n  } catch(err) {\n    throw new Error(err);\n  };\n};\n\n\nexport default handler;\n"]},"metadata":{},"sourceType":"module"}